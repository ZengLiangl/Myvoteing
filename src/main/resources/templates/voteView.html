<!DOCTYPE html PUBliC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.thymeleaf.org"
        xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-Ua-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <link  rel="icon" href="/images/login.jpg">
        <title>查看投票</title>
        <link href="/css/style.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
        <script type="text/javascript" th:src="@{/js/echarts.min.js}"></script>
        <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
        <script type="text/javascript" th:src="@{/layui/layui.js}"></script>
    </head>
    <body class="body">
        <div class="wrap" style="background-color: white;min-height: 720px;">
        <th:block th:include="top.html"/>
        <div class="wrap" id="vote" style="height: 520px">
            <h2>查看投票</h2>
            <ul class="list" style="width: 500px;display: inline-block">
                <li>
                    <blockquote class="layui-elem-quote">
                        <span>
                            <span style="display: inline-block;font-size: 24px;font-weight: bolder;font-family: 华文新魏;">标题：</span>
                            <h3 style="display: inline-block;font-family: 华文新魏;" id="title">哪个浏览器好用</h3>
                        </span>
                        <p class="info">共有<span id="option">4</span> 个选项，已有 <span id="item" style="color: #ff0017">9</span> 个投票。</p>
                    </blockquote>
                    
                    <ol id="items" >
                        <li style="width: 500px;margin-bottom: 10px;">
                            <span  style="font-size: 22px;">IE</span>
                            <div class="rate" >
                                <div class="layui-progress layui-progress-big" lay-showpercent="true">
                                    <div class="layui-progress-bar layui-bg-red" lay-percent="70%"></div>
                                </div>
                            </div>
                            <span style="display: inline-block;float: right">6票<span>(40.0%)</span></span>
                        </li>
                    </ol>
                </li>
            </ul>
            <div style="position: relative;top: -55%;left: 55%;width: 550px;">
                <div id="container" style="height: 250px"></div>
            </div>
        </div>
        <div class="wrap" id="footer"> 北大青鸟 © 版权所有</div>
        </div>
        
        <script type="text/javascript">
            $(function () {
                layui.use(['element','jquery'], function(){
                    var $ = layui.jquery;
                    var element = layui.element;
                    var u=getRequest();
                    $.post('/subject/queryVoteView',u,function (result) {
                        $("#title").text(result.map.title);
                        $("#option").text(result.map.options);
                        $("#item").text(result.map.items);
                        var items='';
                        $.each(result.items,function (index, item) {
                            items+='<li style="width: 500px;margin-bottom: 10px;">'+
                                '<span  style="font-size: 22px;font-family: 华文新魏;">'+(index+1)+'.'+item.ocontent+'</span>' +
                                '<div class="rate">' +
                                ' <div class="layui-progress layui-progress-big" lay-showpercent="true">'+
                                ' <div class="layui-progress-bar layui-bg-red" lay-percent="'+item.percentage.toString().substring(0,5)+'%"></div>'+
                                ' </div>'+
                                '<span  style="display: inline-block;float: right;margin-top: 5px;">'+item.itemCount+'票<span>('+item.percentage.toString().substring(0,5)+'%)</span></span>' +
                                '</div>' +
                                '</li>';
                        });
                         $("#items").html(items);
                         element.render();
                        itemPie(u);
                    })
                });
            });
            function itemPie(u) {
                $.post('/subject/loadItemPie',u, function (result) {
                    var dom = document.getElementById("container");
                    var myChart = echarts.init(dom);
                    var app = {};
                    var option = null;
                    option = {
                        title: {
                            text: '投票统计',
                            subtext: '真实有效',
                            x: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} 票({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: result
                        },
                        series: [
                            {
                                name: '投票数量(占比)',
                                type: 'pie',
                                radius: '55%',
                                center: ['50%', '60%'],
                                data: result,
                                itemStyle: {
                                    emphasis: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    };
                    if (option && typeof option === "object") {
                        myChart.setOption(option, true);
                    }
                });
            }
            //返回?后的json对象
            function getRequest() {
                //获取url中"?"符后的字串
                var url = location.search;
                var theRequest = new Object();
                if (url.indexOf("?") !== -1) {
                    var str = url.substr(1);
                    var strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            }
        </script>
    </body>
</html>
